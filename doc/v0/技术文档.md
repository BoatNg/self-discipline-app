这份技术文档旨在为 AI 编程工具（如 Cursor, Claude Dev）提供清晰的指令，将其转化为一个高性能、响应式的 **PWA WebApp**。

---

## 1. 项目架构与技术栈

* **核心框架**: Vue 3 (Script Setup) + TypeScript
* **构建工具**: Vite (集成 `vite-plugin-pwa`)
* **状态管理**: Pinia + `pinia-plugin-persistedstate` (实现 100% 本地存储)
* **样式处理**: Tailwind CSS (用于快速实现极简、无压力 UI)
* **路由**: Vue Router

---

## 2. 核心数据模型 (Schema)

在 `src/types/index.ts` 中定义，确保类型安全。

```typescript
export type InterveneStep = 'SURFING' | 'BREATHING' | 'RECORDING' | 'RESULT';

export interface UrgeLog {
  id: string;
  timestamp: number;
  stepReached: InterveneStep; // 记录用户停留在哪一步
  triggerReason?: string;     // 压力、无聊等
  outcome: 'resisted' | 'relapsed' | null; // 扛住/没扛住
}

export interface Task {
  id: string;
  name: string;
  enabled: boolean;
}

```

---

## 3. 页面路由与组件结构

WebApp 采用 **App-Shell 模型**，确保页面切换无白屏。

### 3.1 视图定义 (Views)

* `HomeView.vue`: 首页。包含大尺寸的 **"我现在有冲动"** 按钮（占据屏幕中心）。
* `InterventionView.vue`: 干预流容器。使用动态组件切换以下步骤：
1. `TimerStep.vue`: 5 分钟固定倒计时。
2. `BreatheStep.vue`: 呼吸引导。
3. `LogStep.vue`: 触发因素勾选（单选）。
4. `FinishStep.vue`: 最终结果选择（扛住/没扛住）。


* `HistoryView.vue`: 极简列表。展示历史时间戳和结果图标。

---

## 4. 关键技术实现要点

### 4.1 沉浸式干预流 (Intervention Flow)

干预页面不应允许用户被导航干扰。

* **逻辑**: 使用一个局部状态 `currentStep` 控制流程。
* **AI 指令**: "编写一个名为 `InterventionView` 的组件，通过 `switch-case` 渲染四个步骤。除了退出按钮，不显示任何全局导航。"

### 4.2 呼吸动画逻辑 (CSS-Based)

避免使用复杂的 JS 库，利用 CSS 保持丝滑：

```css
/* 模拟 8 秒一个周期的呼吸 */
.breathe-circle {
  animation: breathe-scale 8s ease-in-out infinite;
}

@keyframes breathe-scale {
  0%, 100% { transform: scale(1); }    /* 呼气结束状态 */
  50% { transform: scale(1.6); }      /* 吸气最满状态 */
}

```

### 4.3 离线与 PWA 配置

在 `vite.config.ts` 中配置，确保应用可安装：

* **Manifest**: 设置 `display: "standalone"` 以隐藏浏览器地址栏。
* **Service Worker**: 强制缓存首页和所有干预逻辑相关的 JS/CSS。

---

## 5. 开发任务清单 (给 AI 的 Prompt 建议)

| 阶段 | 任务描述 | AI 提示词建议 |
| --- | --- | --- |
| **P1** | 初始化与存储 | "用 Vue3+TS+Tailwind 搭建项目，配置 Pinia。创建一个 store 记录冲动日志，要求持久化到 localStorage。" |
| **P2** | 首页与导航 | "实现首页布局。中心是一个巨大的圆形按钮‘我现在有冲动’，底部是简单的 Tab 栏（首页、记录、设置）。" |
| **P3** | 干预流逻辑 | "创建 Intervention 页面。第一步显示 5 分钟倒计时，完成后自动跳到呼吸页面。呼吸页面有一个缩放的圆圈。" |
| **P4** | 记录与结果 | "实现最后的选择页面，提供‘我扛住了’和‘我没扛住’两个大按钮，点击后保存记录并返回首页。" |

---

## 6. 非功能性约束

* **视觉压力**: UI 禁用红色、亮橙色等警告色。使用淡绿、柔蓝或浅灰。
* **响应性**: 核心操作按钮必须在手机屏幕底部的 **40% 区域（热区）** 内。
* **隐私**: 严禁调用任何外部 API，所有数据处理逻辑必须在 Client-side 完成。

---
