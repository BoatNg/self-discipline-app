# 注册流程优化和重置密码功能

supabase auth 文档地址：https://supabase.com/docs/guides/auth/passwords#step-2-create-a-change-password-page

## 注册流程优化

### 官方文档
To sign up the user, call signUp() with their email address and password.

You can optionally specify a URL to redirect to after the user clicks the confirmation link. This URL must be configured as a Redirect URL, which you can do in the dashboard for hosted projects, or in the configuration file for self-hosted projects.

If you don't specify a redirect URL, the user is automatically redirected to your site URL. This defaults to localhost:3000, but you can also configure this.

```javascript
async function signUpNewUser() {
  const { data, error } = await supabase.auth.signUp({
    email: 'valid.email@supabase.io',
    password: 'example-password',
    options: {
      emailRedirectTo: 'https://example.com/welcome',
    },
  })
}
```

### **新增获取当前域名，然后拼成拼接成完整的 URL**

* 项目已经做好了回调页面，所以只需要修改`src\stores\useAuthStore.ts`
```javascript

const emailRedirectTo = `${window.location.origin}/auth/callback`

```

## 重置密码功能

* 在`src\components\LoginModal.vue`中添加忘记密码按钮
  * 也需要获取当前域名，然后拼成完整的 URL
* 新增重置密码页面，页面地址是`/auth/update-password`

### 官方文档
Step 1: Create a reset password page

Create a reset password page. This page should be publicly accessible.

Collect the user's email address and request a password reset email. Specify the redirect URL, which should point to the URL of a change password page. This URL needs to be configured in your redirect URLs.

```javascript
await supabase.auth.resetPasswordForEmail('valid.email@supabase.io', {
  redirectTo: 'http://example.com/account/update-password',
})
```

Step 2: Create a change password page
Create a change password page at the URL you specified in the previous step. This page should be accessible only to authenticated users.

Collect the user's new password and call updateUser to update their password.

```javascript
await supabase.auth.updateUser({ password: 'new_password' })
```

Email sending

The signup confirmation and password reset flows require an SMTP server to send emails.

The Supabase platform comes with a default email-sending service for you to try out. The service has a rate limit of 2 emails per hour, and availability is on a best-effort basis. For production use, you should consider configuring a custom SMTP server.