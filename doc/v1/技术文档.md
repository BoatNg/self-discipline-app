这份完整的前端技术文档是专为 **AI 编程工具（如 Cursor, Claude Dev）** 设计的，基于 **Vue 3 + TypeScript** 架构，旨在将你的产品逻辑转化为一个高性能、隐私优先、可离线使用的 **PWA WebApp**。

---

# 技术设计文档：「我不要」冲动管理 WebApp (MVP)

## 1. 技术栈与架构

* **框架**: Vue 3 (Composition API + `<script setup>`)
* **状态管理**: Pinia + `pinia-plugin-persistedstate` (实现 100% 本地持久化)
* **构建工具**: Vite + `vite-plugin-pwa` (支持“添加到主屏幕”及离线使用)
* **样式**: Tailwind CSS (极简、响应式、低认知负荷)
* **路由**: Vue Router (单页应用切换)

---

## 2. 核心数据模型 (TypeScript)

在 `src/types/index.ts` 中统一定义，确保 AI 在生成代码时保持逻辑一致。

```typescript
export type InterventionType = 'TIMER' | 'BREATHE' | 'DUMP';
export type Outcome = 'resisted' | 'relapsed' | null;

export interface UrgeLog {
  id: string;
  timestamp: number;
  assignedIntervention: InterventionType;
  isCompleted: boolean; // 用户是否完整走完干预流程
  outcome: Outcome;    // 最终结果：扛住、没扛住、或未记录
  triggerReason?: string; // 只有在 DUMP 模式下可选关联
}

export interface Task {
  id: string;
  name: string;
  isEnabled: boolean;
}

```

---

## 3. 页面与组件结构

### 3.1 核心视图 (Views)

* **HomeView.vue**: 首页。
* 中心巨大按钮：「我现在有冲动」。
* 底部统计：今日冲动次数、今日工具使用次数。


* **InterventionView.vue**: 干预流容器（核心逻辑）。
* 采用 **随机分发器** 逻辑，用户进入后随机挂载以下三个组件之一。


* **HistoryView.vue**: 极简列表。按时间倒序展示 `Outcome`。

### 3.2 干预流组件 (Intervention Components)

1. **TimerStep.vue (3 分钟延迟)**:
* 固定 180 秒倒计时，使用系统时间差（System Time Delta）校准，防止熄屏挂起。


2. **BreatheStep.vue (呼吸练习)**:
* 60 秒循环 CSS 缩放动画（吸气 4s，呼气 4s）。


3. **DumpStep.vue (认知卸载)**:
* 全屏沉浸式 `textarea`。文案：“写下念头，写完即消失”。不保存文字，点击“我说完了”即完成。



---

## 4. 关键逻辑实现 (AI 指令集)

### 4.1 随机干预分发逻辑

**AI 指令**：

> "在 `InterventionView` 中创建一个数组包含 `TIMER`, `BREATHE`, `DUMP`。使用 `Math.random()` 在组件挂载时选择其一。确保用户在流程中点击左上角 `X` 退出时，静默保存一条 `isCompleted: false` 的日志并返回首页，不得弹出拦截弹窗。"

### 4.2 结果记录逻辑 (无评判设计)

**AI 指令**：

> "流程结束后跳转至结果页。提供两个等权的圆形按钮：‘我扛住了’和‘我没扛住’。点击任何一个均保存 `outcome` 并返回首页。如果用户在此页面直接关闭应用，记录应默认为 `null`。"

### 4.3 PWA 离线能力

**AI 指令**：

> "配置 `vite-plugin-pwa`。设置 `display: standalone` 隐藏地址栏。确保 Service Worker 缓存所有静态资源，使应用在飞行模式下依然能运行 3 分钟倒计时和呼吸动画。"

---

## 5. UI/UX 视觉规范

* **色彩方案**: 柔和的莫兰迪色系。
* 背景: `#F8FAFC` (Slate-50)
* 主文字: `#1E293B` (Slate-800)
* 主按钮: 柔和的深色或低饱和度绿色。


* **交互热区**: 所有核心交互（开始按钮、结果按钮）必须位于手机屏幕底部的 **40% 区域**，方便单手拇指操作。
* **反馈**: 成功完成 3 分钟等待后，调用 `navigator.vibrate(200)` 提供物理反馈。

---

## 6. 边界条件处理汇总表

| 场景 | 处理策略 |
| --- | --- |
| **无任务状态** | 点击主按钮直接开始干预，不询问任务关联。 |
| **倒计时中锁屏** | 重新亮屏时，逻辑层根据 `Date.now()` 自动同步剩余时间。 |
| **中途放弃** | 视为有效干预尝试，但不标记为 `isCompleted`，不给用户挫败感。 |
| **数据隐私** | 所有 `UrgeLog` 仅存在 `localStorage`，不进行任何 API 调用。 |

---

## 7. 分阶段开发建议 (Prompt 顺序)

1. **第一步**: "初始化 Vue 3 + TS 项目，安装 Pinia，实现基于 localStorage 的日志存储 Store。"
2. **第二步**: "实现首页布局和路由，添加‘我现在有冲动’按钮。"
3. **第三步**: "编写 `InterventionView`，实现随机分发 3 分钟倒计时、呼吸、认知卸载三个组件的逻辑。"
4. **第四步**: "完善 `DumpStep` 认知卸载组件，确保文字不被保存，且输入体验沉浸。"
5. **第五步**: "配置 PWA 插件，确保应用可添加到手机桌面并离线使用。"

---
