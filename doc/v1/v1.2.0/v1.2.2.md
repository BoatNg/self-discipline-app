

# 月历视图「时间态 × 任务状态」最终规则

## 一、先给结论（产品规则一句话版）

> **只有「今天及未来日期」允许显示「未进行」；
> 过去日期不允许出现「未进行」，只能是「成功 / 失败」。**

---

## 二、引入一个关键概念：日期态（Time State）

对每一个日期 `D`，先判断它相对于「今天」的状态：

| 日期态 | 定义        |
| --- | --------- |
| 过去  | D < today |
| 今天  | D = today |
| 未来  | D > today |

> **日期态的判断优先级，高于任务状态**

---

## 三、最终完整判定流程（终极版）

### Step 0：是否在任务有效区间内？

```text
D < startDate
或
(D > endDate 且 endDate 存在)
```

✅ 是 → **空白（直接结束）**

---

### Step 1：是否存在执行记录？

```text
records[D] 存在
```

| 记录结果 | 展示    |
| ---- | ----- |
| 成功   | 🟢 成功 |
| 失败   | 🔴 失败 |

> ⚠️ **执行记录永远具有最高展示优先级**

---

### Step 2：无执行记录 → 看日期态

#### ① D < today（过去）

✅ **展示：🔴 失败（系统判定）**

> 产品含义：
> 「这一天本该做，但已经错过了」

❌ 不允许：

* 灰色未进行
* 空白（因为任务在周期内）

---

#### ② D = today（今天）

✅ **展示：⚪️ 未进行（灰色）**

> 含义：
> 「今天还来得及」

---

#### ③ D > today（未来）

✅ **展示：⚪️ 未进行（灰色）**

> 含义：
> 「计划中的任务」

---

## 四、最终真值表（PRD 级）

| 时间区间                      | 是否有记录 | 展示        |
| ------------------------- | ----- | --------- |
| 不在 `[startDate, endDate]` | -     | 空白        |
| 任意日期                      | 成功记录  | 🟢 成功     |
| 任意日期                      | 失败记录  | 🔴 失败     |
| 过去                        | 无记录   | 🔴 失败（系统） |
| 今天                        | 无记录   | ⚪️ 未进行    |
| 未来                        | 无记录   | ⚪️ 未进行    |

---

## 五、Markdown 表格示例（含今天）

假设：

* today = 6日
* 🏃‍♂️ 运动：1日 ~ 10日

```markdown
| 日期 | 🏃‍♂️ 运动 |
|----|-----------|
| 1日 | 🟢 成功 |
| 2日 | 🔴 失败 |
| 3日 | 🔴 失败 |
| 4日 | 🟢 成功 |
| 5日 | 🔴 失败 |
| 6日 | ⚪️ 未进行 |
| 7日 | ⚪️ 未进行 |
| 8日 | ⚪️ 未进行 |
| 9日 | ⚪️ 未进行 |
| 10日| ⚪️ 未进行 |
| 11日|           |
```

你会发现：

* **过去没有灰色**
* **灰色只出现在「今天 & 未来」**
* **结束后仍然是空白**

---

## 六、为什么这是“最合理”的设计

### 1️⃣ 心理模型完全符合直觉

* 灰色 =「还有机会」
* 红色 =「已经错过」

### 2️⃣ 强行为反馈

* 不记录 ≠ 没关系
* 过去没做 = 明确失败

### 3️⃣ 行为型产品必备设计

* 戒烟 / 打卡 / 习惯养成类产品的行业通用逻辑

---

## 七、前端实现（极简伪代码）

```ts
if (date < startDate) return null
if (endDate && date > endDate) return null

if (record) return record.result // success / fail

if (date < today) return 'fail'
return 'pending' // today or future
```

---


